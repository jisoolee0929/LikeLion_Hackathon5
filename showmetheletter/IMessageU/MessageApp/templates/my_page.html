{% extends 'base.html' %}
{% load static %} 

{% block css %}
<link href="{% static 'css/my_page.css' %}" rel="stylesheet">
{% endblock %}

{% block title %}
{% endblock %}

{% block content %}
<div class="container" style="width: 100%;">
    <div class="container-header text-center">
      <br/><br/><br/>
    </div>
    <div class="container-body text-center">
      <!--ë¡œê·¸ì¸ ì•ˆí•œ ìƒíƒœì—ì„œ ì¹œêµ¬ì˜ í¸ì§€í•¨ì„ ë°©ë¬¸í–ˆì„ ë•Œ-->
        {% if user.is_anonymous %}
        <div class="card text-center rounded-4 p-3 pb-2">
			    <h3>ì¹œêµ¬ì•¼, ë„ˆì˜ í¸ì§€ë¥¼ ì½ê³ ì‹¶ì–´!</h3>
          <p style="color: black;">
          ìƒëŒ€ë°©ì€ ë‹¹ì‹ ì´ ì„¤ì •í•œ ì‹œê°„ë§Œí¼ ê³µë¶€ë¥¼ í•´ì•¼ ë‹¹ì‹ ì˜ í¸ì§€ë¥¼ ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ëœ»í•œ ë§ˆìŒì„ ë‹´ì€ í¸ì§€ë¥¼ ì¹œêµ¬ì—ê²Œ ì „í•˜ê³ , ì¹œêµ¬ì˜ ê³µë¶€ê¹Œì§€ ë„ì™€ì¤„ ìˆ˜ ìˆì–´ìš”!<br/>
         (í¸ì§€ë¥¼ ì‘ì„±í•˜ë ¤ë©´ <strong><u>ë¡œê·¸ì¸</u></strong>ì´ í•„ìš”í•©ë‹ˆë‹¤. ì™¼ìª½ ìƒë‹¨ ë©”ë‰´ ë²„íŠ¼ì„ í´ë¦­í•˜ì‹œê³  íšŒì›ê°€ì…ì„ ë¨¼ì € í•´ì£¼ì„¸ìš”!)
          </p>
				</div>
        <div class="container">
          <div class="row">
            <div class="col-12" style="text-align: center;">
              <!-- í¸ì§€ ì‘ì„±í•˜ê¸° ëª¨ë‹¬ ë²„íŠ¼(ì‘ë™ ì•ˆë˜ê²Œ í•´ë†¨ìŒ) -->
              <img type="button" class="img-fluid" data-bs-toggle="modal" data-bs-target="#createMessageModal2" src="https://github.com/jisoolee0929/LikeLion_Hackathon5/blob/main/image/text_balloon.png?raw=true" style="width:40%; position: relative; top: 30px;" alt="write_message">
              <img src="https://github.com/jisoolee0929/LikeLion_Hackathon5/blob/main/%EC%82%AC%EB%9E%8C%EC%BA%90%EB%A6%AD%ED%84%B0.png?raw=true" class="img-fluid" alt="character" style="width: 70%;">
            </div>
          </div>
        {% endif %}

        {% if user.is_authenticated and isHost == False %}
				<div class="card text-center rounded-4 p-3 pb-2">
			    <h3>ìƒëŒ€ë°©ì˜ ì‹œí—˜ê³µë¶€ë¥¼ ë„ì™€ì£¼ì„¸ìš”</h3>
          <p style="color:black;">ìƒëŒ€ë°©ì€ ë‹¹ì‹ ì´ ì„¤ì •í•œ ì‹œê°„ë§Œí¼ ê³µë¶€ë¥¼ í•´ì•¼ë§Œ ë‹¹ì‹ ì˜ í¸ì§€ë¥¼ ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ëœ»í•œ ë§ˆìŒì„ ë‹´ì€ í¸ì§€ë¥¼ ì¹œêµ¬ì—ê²Œ ì „í•˜ê³ , ì¹œêµ¬ì˜ ê³µë¶€ê¹Œì§€ ë„ì™€ì¤„ ìˆ˜ ìˆì–´ìš”!<br/>
            (ì—°í•„ì„ í´ë¦­í•˜ê³  í¸ì§€ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”!)</p>
				</div>
        {% endif %}

        {% if user.is_authenticated and isHost == True %}
        <div class="card text-center rounded-4 p-3 pb-2 bg-warning">
          <h3>ë‚´ ì´ ê³µë¶€ì‹œê°„: {{ user.total_time }}ì´ˆ</h3>
          <p style="color: black;">ë‚´ í¸ì§€í•¨ ì£¼ì†Œë¥¼ SNSì— ê³µìœ í•˜ê³  ì¹œêµ¬ë“¤ë¡œë¶€í„° í¸ì§€ë¥¼ ë°›ì•„ë³´ì„¸ìš”! <br/>p.s. ì¹œêµ¬ê°€ ì„¤ì •í•œ ì‹œê°„ë§Œí¼ ê³µë¶€ë¥¼ í•´ì•¼ í¸ì§€ë¥¼ ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤ :) </p>
          {% if user.is_authenticated and isHost == True %}
          <div style="text-align:center;">
            <a class="btn btn-light" onclick="clip(); return false;"><i class="fa-solid fa-arrow-up-from-bracket"></i><strong>&nbsp;ë‚´ í¸ì§€í•¨ ê³µìœ í•˜ê¸°</strong></a>
          </div>
          {% endif %}
        </div>
        <br/>
        <div class="card rounded-4 p-2">
          <div id = "demo" class = "time">
            <h3>ìŠ¬ìŠ¬ ê³µë¶€ ì¢€ í•´ë³¼ê¹Œ...?</h3>
          </div>
          <div style="display: flex;">
            <div class = "btnflex">
              <label for="sucess">ê³µë¶€ì‹œì‘</label>
              <button class="btn success" name="sucess" value="start" onclick="starttimer()"><img class = "btnimg" src="https://cdn-icons-png.flaticon.com/512/38/38483.png" alt="ì‹œì‘" style="width: 10%;"></button>
            </div>
            <div>
              <label for="stop">ê³µë¶€ì¤‘ë‹¨</label>
              <button class="btn danger" name="stop" value="stop" onclick="stopTimer()"><img class="btnimg" src="https://cdn-icons-png.flaticon.com/512/64/64485.png" alt="ì¤‘ë‹¨" style="width: 10%;"></button>
            </div>
            <div>
              <form method="POST" action="{% url 'time_submit' user.pk %}">
              {% csrf_token %}
              <input type="number" id="totaltime" name="totaltime" tabindex="3" style="display:none;">
              <label for="submit">ì‹œê°„ì œì¶œ</label>
              <button type="submit" name = "ì œì¶œí•˜ê¸°" class="btn" onclick="submitTimer()"><img class="btnimg" src="https://cdn-icons-png.flaticon.com/512/2708/2708395.png" alt="ì œì¶œ" style="width: 10%;"></button>
              </form>                      
            </div>  
          </div>  
        </div>
        {% endif %}
	</div>
  <br/>
        <div class="container">
            <div class="row">
                {% if user.is_authenticated and isHost == True %}
                <div class="col-6">
                    <img src="https://github.com/jisoolee0929/LikeLion_Hackathon5/blob/main/%EC%82%AC%EB%9E%8C%EC%BA%90%EB%A6%AD%ED%84%B0.png?raw=true" class="img-fluid" style="width: 100%;" alt="character">
                </div>
    
                <div class="col-6" style="display: flex; align-content: center; align-items:center;">
                  {% if len_closed >= 1 %}
                  <div style="text-align: center;">
                    <span class="text-muted"><small>ì•ˆì½ì€ í¸ì§€ê°€ ìˆì–´ìš”! í¸ì§€í•¨ì„ í´ë¦­í•´ë³´ì„¸ìš”.</small></span>
                  {% endif %}                    
                    <!-- í¸ì§€ ëª©ë¡ë³´ê¸° ëª¨ë‹¬ ë²„íŠ¼ -->
                    <button class="btn position-relative" data-bs-toggle="modal" data-bs-target="#listMessageModal" alt="list_message">
                      <span class="position-relative top-100 start-45 translate-middle badge rounded-pill bg-danger" style="bottom: 20px; left: 40px;">í´ë¦­!</span>
                      <span class="position-absolute top-50 start-50 translate-middle badge rounded-pill bg-primary">
                        {{ len_closed }}+
                        <span class="visually-hidden">ì•ˆì½ì€ í¸ì§€</span>
                      </span>
                      <img src="https://github.com/jisoolee0929/LikeLion_Hackathon5/blob/main/image/mailbox.png?raw=true" style="width:60%; background:transparent;">
                    </button>
                  </div>
                </div>
                {% endif %}                    


                {% if user.is_authenticated and isHost == False %}
                <div class="col-12" style="text-align: center;">
                  <!-- í¸ì§€ ì‘ì„±í•˜ê¸° ëª¨ë‹¬ ë²„íŠ¼ -->
                  <img type="button" class="img-fluid" data-bs-toggle="modal" data-bs-target="#createMessageModal" src="https://github.com/jisoolee0929/LikeLion_Hackathon5/blob/main/image/text_balloon.png?raw=true" style="width:40%; position: relative; top: 30px;" alt="write_message">
                  <img src="https://github.com/jisoolee0929/LikeLion_Hackathon5/blob/main/%EC%82%AC%EB%9E%8C%EC%BA%90%EB%A6%AD%ED%84%B0.png?raw=true" class="img-fluid" alt="character" style="width: 70%;">
                </div>
                {% endif %}
            </div>
        </div>
    </div>
  </div>
</div>

<!-- í¸ì§€ ì‘ì„±í•˜ê¸° ëª¨ë‹¬(ë¡œê·¸ì¸ì‹œ) -->
<div class="modal fade in" id="createMessageModal" tabindex="-1" aria-labelledby="createMessageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">ìƒëŒ€ë°©ì—ê²Œ ë‹¹ì‹ ì˜ ë§ˆìŒì„ ë‚¨ê²¨ì£¼ì„¸ìš”!</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="container">
            <div class="row">
                    <form id="contact-form" class="form" method="POST" role="form"> 
                        {% csrf_token %}
                        <div class="form-group">
                            <label class="form-label" for="name">ë‹‰ë„¤ì„</label>
                            <input type="text" class="form-control" id="nickname" name="nickname" placeholder="ë‹¹ì‹ ì˜ ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”(10ì ì´í•˜)." tabindex="1" required>
                        </div>                            
                                        
                        <div class="form-group">
                            <label class="form-label" for="title">í¸ì§€ ì œëª©</label>
                            <input type="text" class="form-control" id="title" name="title" placeholder="í¸ì§€ ì œëª©ì„ ì ì–´ì£¼ì„¸ìš”." tabindex="3">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="left_time">ê³µë¶€ ì‹œê°„</label>
                            <input type="range" name="left_time" id="left_time" min="0" max="3600" value= "1800" placeholder="ìƒëŒ€ë°©ì„ ì–¼ë§Œí¼ ê³µë¶€ì‹œí‚¬ê¹Œìš”?">
                            <label class="form-label" for="left_time" style="color:gray;">ìµœëŒ€: 60ë¶„</label>
                        </div>

                        <div class="form-group">
                          <label class="form-label" for="message_cover">í¸ì§€ ì¥ì‹</label>
                            <div class="form-check form-check-inline">
                              <input class="form-check-input" type="radio" name="message_cover" id="inlineRadio1" value="1">
                              <label class="form-check-label" for="inlineRadio1">â¤ï¸</label>
                            </div>
                            <div class="form-check form-check-inline">
                              <input class="form-check-input" type="radio" name="message_cover" id="inlineRadio2" value="2">
                              <label class="form-check-label" for="inlineRadio2">ğŸ</label>
                            </div>
                            <div class="form-check form-check-inline">
                              <input class="form-check-input" type="radio" name="message_cover" id="inlineRadio3" value="3">
                              <label class="form-check-label" for="inlineRadio3">ğŸ’‹</label>
                            </div>
                            <div class="form-check form-check-inline">
                              <input class="form-check-input" type="radio" name="message_cover" id="inlineRadio3" value="4">
                              <label class="form-check-label" for="inlineRadio3">ğŸ’¯</label>
                            </div>
                            <div class="form-check form-check-inline">
                              <input class="form-check-input" type="radio" name="message_cover" id="inlineRadio3" value="5">
                              <label class="form-check-label" for="inlineRadio3">ğŸ«</label>
                            </div>
                            <div class="form-check form-check-inline">
                              <input class="form-check-input" type="radio" name="message_cover" id="inlineRadio3" value="6">
                              <label class="form-check-label" for="inlineRadio3">ğŸ€</label>
                            </div>                        
                        </div>
  
                        <div class="form-group">
                            <label class="form-label" for="content">í¸ì§€ ë‚´ìš©</label>
                            <textarea rows="10" cols="50" name="content" class="form-control" id="content" placeholder="ë”°ëœ»í•œ ë©”ì„¸ì§€ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”." tabindex="4" required></textarea>                                 
                        </div>            
                    </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">ì‘ì„±</button>
          </form>
        </div>
      </div>
    </div>
  </div>

<!-- í¸ì§€ ëª©ë¡ë³´ê¸° ëª¨ë‹¬ -->
<div class="modal fade in" id="listMessageModal" tabindex="-1" aria-labelledby="listMessageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">ë„ì°©í•œ ë§ˆìŒ: {{ len_message }}ê°œ
          <span class="text-muted"><small>(ì—´ì–´ë³¸ ë§ˆìŒ: {{ len_open }}ê°œ)</small></span>
          </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="container">
            <div class="row">
                {% if messages %}
                {% for m in messages %} 
                <div class="col-2" style="text-align: center; font-size: 13px;">
                  {% if m.left_time >= 1 and m.left_time <= 1200 %} 
                    <img src="https://github.com/jisoolee0929/LikeLion_Hackathon5/blob/main/image/clock3.png?raw=true" style="width: 100%;" alt="time">
                    <small>{{ m.minute }}ë¶„{{ m.second }}ì´ˆ</small>

                    {% elif m.left_time >= 1201 and m.left_time <= 2400 %}
                    <img src="https://github.com/jisoolee0929/LikeLion_Hackathon5/blob/main/image/clock2.png?raw=true" style="width: 100%;" alt="time">
                    <small>{{ m.minute }}ë¶„{{ m.second }}ì´ˆ</small>

                    {% elif m.left_time >= 2401 and m.left_time <= 3600 %}
                    <img src="https://github.com/jisoolee0929/LikeLion_Hackathon5/blob/main/image/clock1.png?raw=true" style="width: 100%;" alt="time">
                    <small>{{ m.minute }}ë¶„{{ m.second }}ì´ˆ</small>
                    {% else %}
                        {% if m.message_cover == 1 %} 
                        <a href="{% url 'message_detail' m.pk %}"><img src="https://github.com/jisoolee0929/LikeLion_Hackathon5/blob/main/heart.png?raw=true" style="width: 100%;" alt="â¤ï¸"></a>
                        {% endif %}
                        {% if m.message_cover == 2 %} 
                        <a href="{% url 'message_detail' m.pk %}"><img src="https://github.com/jisoolee0929/LikeLion_Hackathon5/blob/main/gift.png?raw=true" style="width: 100%;" alt="ğŸ"></a>
                        {% endif %}
                        {% if m.message_cover == 3 %} 
                        <a href="{% url 'message_detail' m.pk %}"><img src="https://github.com/jisoolee0929/LikeLion_Hackathon5/blob/main/kiss.png?raw=true" style="width: 100%;" alt="ğŸ’‹"></a>
                        {% endif %}
                        {% if m.message_cover == 4 %} 
                        <a href="{% url 'message_detail' m.pk %}"><img src="https://github.com/jisoolee0929/LikeLion_Hackathon5/blob/main/image/100.png?raw=true" style="width: 100%;" alt="ğŸ’¯"></a>
                        {% endif %}
                        {% if m.message_cover == 5 %} 
                        <a href="{% url 'message_detail' m.pk %}"><img src="https://github.com/jisoolee0929/LikeLion_Hackathon5/blob/main/image/Chocolate.png.png?raw=true" style="width: 100%;" alt="ğŸ«"></a>
                        {% endif %}
                        {% if m.message_cover == 6 %} 
                        <a href="{% url 'message_detail' m.pk %}"><img src="https://github.com/jisoolee0929/LikeLion_Hackathon5/blob/main/image/clover.png?raw=true" style="width: 100%;" alt="ğŸ€"></a>
                        {% endif %}
                    {% endif %} 
                </div>
                {% endfor %}
                {% else %} 
                <p>ì•„ì§ ë„ì°©í•œ ë§ˆìŒì´ ì—†ìŠµë‹ˆë‹¤.</p>
                {% endif %}
              </div>
            <br/>
            {% if len_message != 0 %}
            <div class="row">
                <p>ê³µë¶€ì‹œê°„ì„ ì±„ìš°ë©´ í¸ì§€ê°€ ì‹œê³„ ëª¨ì–‘ì—ì„œ ì¹œêµ¬ê°€ ì„¤ì •í•œ ëª¨ì–‘ìœ¼ë¡œ ìë™ìœ¼ë¡œ ë°”ë€ë‹ˆë‹¤. í¸ì§€ë¥¼ ì½ìœ¼ë ¤ë©´ íƒ€ì´ë¨¸ë¡œ ê³µë¶€ì‹œê°„ì„ ì œì¶œí•˜ì„¸ìš”!</p>
            </div>
            {% endif %}
          </div>
        </div>
        <div class="modal-footer">

        </div>
      </div>
    </div>
  </div>

<script>
let timer
var time = 0
var stop = document.querySelector(".danger");
var start = document.querySelector(".success");

function starttimer(){
  start.disabled = true;
  stop.disabled = false;
    var min = ""
    var sec = ""
    timer = setInterval(function(){
            min = parseInt(time/60);
            sec = time%60;
            document.getElementById("demo").innerHTML = min + "ë¶„" + sec + "ì´ˆ";
            document.getElementById("totaltime").value = time;
            time++;
        }, 1000);
}

function stopTimer(){
    clearInterval(timer);
    start.disabled = false;
    stop.disabled = true;

}

function submitTimer(){
    time = 0
}


function clip(){

var url = '';
var textarea = document.createElement("textarea");
document.body.appendChild(textarea);
url = window.document.location.href;
textarea.value = url;
textarea.select();
document.execCommand("copy");
document.body.removeChild(textarea);
alert("ë‚´ í¸ì§€í•¨ì˜ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.\nì¹œêµ¬ë“¤ì´ í¸ì§€ë¥¼ ì¨ì¤„ ìˆ˜ ìˆë„ë¡ SNSì— ê³µìœ í•´ë³´ì„¸ìš”!")
}

</script>
{% endblock %}
